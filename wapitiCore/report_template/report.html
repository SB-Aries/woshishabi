<!DOCTYPE html>
<html>
<head>
	<title>Wapiti 漏洞扫描报告</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>
<body>
    <div id="page">
        <header style="text-align: center">
        <h2 class="title" style="text-align: center">漏洞扫描报告</h2>
        <h3>扫描目标: ${target}</h3>
        <p>扫描日期: ${scan_date}。扫描范围: ${scan_scope}。已爬取页面数量: ${crawled_pages_nbr}</p>
        </header>
        <hr />
        % if auth_dict != None:
        <h4>身份验证信息</h4>
        <p>
            地址: ${auth_dict["url"]}<br>
            登录状态: ${auth_dict["logged_in"]}<br>
            % if auth_form_dict != None and len(auth_form_dict) > 0:
            登录字段: ${auth_form_dict["login_field"]}<br>
            密码字段: ${auth_form_dict["password_field"]}<br>
            % endif
        </p>
        <hr />
        % endif

        <h4>报告摘要</h4>
        <table class="summary-table" style="background: url('logo_clear.png') no-repeat center;">
            <thead>
                <tr>
                    <th>类别</th>
                    <th>发现的问题数量</th>
                </tr>
            </thead>
            <tbody id="summary">
                % for i, vuln_name in enumerate(vulnerabilities):
                    <tr>
                        <td class="small">
                            % if len(vulnerabilities[vuln_name]):
                            <a href="#vuln_type_${i}">${vuln_name}</a>
                            % else:
                            ${vuln_name}
                            % endif
                        </td>
                        <td class="small text-centered">${len(vulnerabilities[vuln_name])}</td>
                    </tr>
                % endfor
                % for i, anomaly_name in enumerate(anomalies):
                    <tr>
                        <td class="small">
                            % if len(anomalies[anomaly_name]):
                            <a href="#anom_type_${i}">${anomaly_name}</a>
                            % else:
                            ${anomaly_name}
                            % endif
                        </td>
                        <td class="small text-centered">${len(anomalies[anomaly_name])}</td>
                    </tr>
                % endfor
                % for i, additional_name in enumerate(additionals):
                    <tr>
                        <td class="small">
                            % if len(additionals[additional_name]):
                            <a href="#addition_type_${i}">${additional_name}</a>
                            % else:
                            ${additional_name}
                            % endif
                        </td>
                        <td class="small text-centered">${len(additionals[additional_name])}</td>
                    </tr>
                % endfor
            </tbody>
        </table>
        <hr />
        <div id="details">
            % for i, vuln_name in enumerate(vulnerabilities):
                % if len(vulnerabilities[vuln_name]):
                <h3 id="vuln_type_${i}">${vuln_name}</h3>
                <dl>
                    <dt>描述</dt>
                    <dd>${flaws[vuln_name]["desc"] | h}</dd>
                </dl>

                    % for j, vulnerability in enumerate(vulnerabilities[vuln_name]):
                    <div class="tab-container">
                        <h4><span class="severity ${level_to_css_class(vulnerability["level"])}"></span> 在 ${vulnerability["path"] | h} 中发现漏洞</h4>
                        <nav class="tab-nav">
                            <a href="#tab-vuln-${i}-${j}-1" class="tab-link active">描述</a>
                            <a href="#tab-vuln-${i}-${j}-2" class="tab-link">HTTP 请求</a>
                            % if detailed_report is True and vulnerability["detail"]["response"] is not None:
                                <a href="#tab-vuln-${i}-${j}-3" class="tab-link">HTTP 响应</a>
                            % endif
                            <a href="#tab-vuln-${i}-${j}-4" class="tab-link">cURL 命令行</a>
                            <a href="#tab-vuln-${i}-${j}-5" class="tab-link">WSTG 编码</a>
                        </nav>
                        <section id="tab-vuln-${i}-${j}-1" class="tab-content" style="min-height: 124px;">
                            <pre>${vulnerability["info"] | h}</pre>
                        </section>
                        <section id="tab-vuln-${i}-${j}-2" class="tab-content" style="min-height: 124px; display: none;">
                            <pre style="white-space: normal;">
                                % for line in vulnerability["http_request"].split("\n"):
                                    ${line | h}
                                    <br>
                                % endfor
                            </pre>
                        </section>
                        % if detailed_report is True and vulnerability["detail"]["response"] is not None:
                            <section id="tab-vuln-${i}-${j}-3" class="tab-content" style="min-height: 124px; display: none;">
                                <pre style="white-space: nowrap">
                                    HTTP ${vulnerability["detail"]["response"]["status_code"] | h}<br />
                                    % if vulnerability["detail"]["response"]["headers"] is not None:
                                        % for header in vulnerability["detail"]["response"]["headers"]:
                                            ${header[0] | h}: ${header[1] | h}<br />
                                        %endfor
                                    %endif
                                    <br />
                                    ${vulnerability["detail"]["response"]["body"] | h}
                                </pre>
                            </section>
                        % endif
                        <section id="tab-vuln-${i}-${j}-4" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${vulnerability["curl_command"] | h}</pre>
                        </section>
                        <section id="tab-vuln-${i}-${j}-5" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${vulnerability["wstg"] | h}</pre>
                        </section>
                    </div>
                    % endfor

                <dl><dt>解决方案</dt><dd>${flaws[vuln_name]["sol"]}</dd></dl>
                <h5>参考资料</h5>
                <ul>
                    % for ref_name, ref_url in flaws[vuln_name]["ref"].items():
                    <li><a href="${ref_url}">${ref_name | h}</a></li>
                    % endfor
                </ul>
                <br />
                <hr>
                % endif
            % endfor
            % for i, anomaly_name in enumerate(anomalies):
                % if len(anomalies[anomaly_name]):
                <h3 id="anom_type_${i}">${anomaly_name}</h3>
                <dl>
                    <dt>描述</dt>
                    <dd>${flaws[anomaly_name]["desc"] | h}</dd>
                </dl>

                    % for j, anomaly in enumerate(anomalies[anomaly_name]):
                    <div class="tab-container">
                        <h4><span class="severity severity-info"></span> 在 ${anomaly["path"] | h} 中发现异常</h4>
                        <nav class="tab-nav">
                            <a href="#tab-anom-${i}-${j}-1" class="tab-link active">描述</a>
                            <a href="#tab-anom-${i}-${j}-2" class="tab-link">HTTP 请求</a>
                            % if detailed_report is True and anomaly["detail"]["response"] is not None:
                                <a href="#tab-anom-${i}-${j}-3" class="tab-link">HTTP 响应</a>
                            % endif
                            <a href="#tab-anom-${i}-${j}-4" class="tab-link">cURL 命令行</a>
                            <a href="#tab-anom-${i}-${j}-5" class="tab-link">WSTG 编码</a>
                        </nav>
                        <section id="tab-anom-${i}-${j}-1" class="tab-content" style="min-height: 124px;">
                            <pre>${anomaly["info"] | h}</pre>
                        </section>
                        <section id="tab-anom-${i}-${j}-2" class="tab-content" style="min-height: 124px; display: none;">
                            <pre style="white-space: normal">
                                % for line in anomaly["http_request"].split("\n"):
                                    ${line | h}
                                    <br>
                                % endfor
                            </pre>
                        </section>
                        % if detailed_report is True and anomaly["detail"]["response"] is not None:
                            <section id="tab-anom-${i}-${j}-3" class="tab-content" style="min-height: 124px; display: none;">
                                <pre style="white-space: nowrap">
                                    HTTP ${anomaly["detail"]["response"]["status_code"] | h}<br />
                                    % if anomaly["detail"]["response"]["headers"] is not None:
                                        % for header in anomaly["detail"]["response"]["headers"]:
                                            ${header[0] | h}: ${header[1] | h}<br />
                                        %endfor
                                    %endif
                                    <br />
                                    ${anomaly["detail"]["response"]["body"] | h}
                                </pre>
                            </section>
                        % endif
                        <section id="tab-anom-${i}-${j}-4" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${anomaly["curl_command"] | h}</pre>
                        </section>
                        <section id="tab-anom-${i}-${j}-5" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${anomaly["wstg"] | h}</pre>
                        </section>
                    </div>
                    % endfor

                <dl><dt>解决方案</dt><dd>${flaws[anomaly_name]["sol"]}</dd></dl>
                <h5>参考资料</h5>
                <ul>
                    % for ref_name, ref_url in flaws[anomaly_name]["ref"].items():
                    <li><a href="${ref_url}">${ref_name | h}</a></li>
                    % endfor
                </ul>
                <br />
                <hr>
                % endif
            % endfor
            % for i, additional_name in enumerate(additionals):
                % if len(additionals[additional_name]):
                <h3 id="addition_type_${i}">${additional_name}</h3>
                <dl>
                    <dt>描述</dt>
                    <dd>${flaws[additional_name]["desc"] | h}</dd>
                </dl>

                    % for j, additional in enumerate(additionals[additional_name]):
                    <div class="tab-container">
                        <h4><span class="severity ${level_to_css_class(additional["level"])}"></span> 在 ${additional["path"] | h} 中发现附加信息</h4>
                        <nav class="tab-nav">
                            <a href="#tab-addition-${i}-${j}-1" class="tab-link active">描述</a>
                            <a href="#tab-addition-${i}-${j}-2" class="tab-link">HTTP 请求</a>
                            % if detailed_report is True and additional["detail"]["response"] is not None:
                                <a href="#tab-addition-${i}-${j}-3" class="tab-link">HTTP 响应</a>
                            % endif
                            <a href="#tab-addition-${i}-${j}-4" class="tab-link">cURL 命令行</a>
                            <a href="#tab-addition-${i}-${j}-5" class="tab-link">WSTG 编码</a>
                        </nav>
                        <section id="tab-addition-${i}-${j}-1" class="tab-content" style="min-height: 124px;">
                            <pre>${additional["info"] | h}</pre>
                        </section>
                        <section id="tab-addition-${i}-${j}-2" class="tab-content" style="min-height: 124px; display: none;">
                            <pre style="white-space: normal">
                                % for line in additional["http_request"].split("\n"):
                                    ${line | h}
                                    <br>
                                % endfor
                            </pre>
                        </section>
                        % if detailed_report is True and additional["detail"]["response"] is not None:
                            <section id="tab-addition-${i}-${j}-3" class="tab-content" style="min-height: 124px; display: none;">
                                <pre style="white-space: nowrap">
                                    HTTP ${additional["detail"]["response"]["status_code"] | h}<br />
                                    % if additional["detail"]["response"]["headers"] is not None:
                                        % for header in additional["detail"]["response"]["headers"]:
                                            ${header[0] | h}: ${header[1] | h}<br />
                                        %endfor
                                    %endif
                                    <br />
                                    ${additional["detail"]["response"]["body"] | h}
                                </pre>
                            </section>
                        % endif
                        <section id="tab-addition-${i}-${j}-4" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${additional["curl_command"] | h}</pre>
                        </section>
                        <section id="tab-addition-${i}-${j}-5" class="tab-content" style="min-height: 124px; display: none;">
                            <pre>${additional["wstg"] | h}</pre>
                        </section>
                    </div>
                    % endfor
                <dl><dt>解决方案</dt><dd>${flaws[additional_name]["sol"]}</dd></dl>
                <h5>参考资料</h5>
                <ul>
                    % for ref_name, ref_url in flaws[additional_name]["ref"].items():
                    <li><a href="${ref_url}">${ref_name | h}</a></li>
                    % endfor
                </ul>
                <br />
                <hr>
                % endif
            % endfor
        </div>
        <footer class="small" id="footer"><a href="https://github.com/SB-Aries/" id="Aries_link">${Aries_LOVE}</a> &copy; I’m because you are </footer>
	</div>
    <script type="text/javascript" src="js/app.js"></script>
</body>
</html>